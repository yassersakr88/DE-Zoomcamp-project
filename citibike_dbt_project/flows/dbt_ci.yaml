id: dbt_ci
namespace: citibike
tasks:
  - id: git_pull
    type: io.kestra.plugin.git.Clone
    url: "{{ vars.GIT_REPO_URL }}"
    branch: main
  - id: dbt_run_tests
    type: io.kestra.plugin.dbt.cli.Run
    runner: DBT_RUNNER
    projectDir: /home/kestra/citibike_dbt_project
    commands:
      - dbt deps
      - dbt run --target ci
      - dbt test --target ci